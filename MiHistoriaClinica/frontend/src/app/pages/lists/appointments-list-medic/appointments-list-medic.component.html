<h1 class = "text-center">Historial Consultas Médicas</h1>
<h6 class="text-center">Paciente: {{ patient?.name }} {{ patient?.lastname }}, DNI: {{ patient?.dni }}</h6>
<br>
<table class="table table-striped">
    <thead class="table-dark">
    <tr>
        <th>Nombre del médico</th>
        <th>Especialidad</th>
        <th>Motivo de consulta</th>
        <th>Síntomas</th>
        <th>Exámen físico</th>
        <th>Observaciones</th>
        <th>Estado</th>
        <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let appointment of appointments">
        <td>{{appointment.medicFullName}}</td>
        <td>{{appointment.specialty}}</td>
        <td>{{appointment.appointmentReason}}</td>
        <td>
            <span class="expandable-text" 
                  style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                  (mouseenter)="showTooltip($event, appointment.currentIllness)" 
                  (mouseleave)="hideTooltip()">
                {{ appointment.currentIllness && appointment.currentIllness.length > 50 ? (appointment.currentIllness.substring(0, 50) + '...') : appointment.currentIllness }}
            </span>
        </td>
        <td>
            <span class="expandable-text" 
                  style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                  (mouseenter)="showTooltip($event, appointment.physicalExam)" 
                  (mouseleave)="hideTooltip()">
                {{ appointment.physicalExam && appointment.physicalExam.length > 50 ? (appointment.physicalExam.substring(0, 50) + '...') : appointment.physicalExam }}
            </span>
        </td>
        <td>
            <span class="expandable-text" 
                  style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                  (mouseenter)="showTooltip($event, appointment.observations)" 
                  (mouseleave)="hideTooltip()">
                {{ appointment.observations && appointment.observations.length > 50 ? (appointment.observations.substring(0, 50) + '...') : appointment.observations }}
            </span>
        </td>
        <td>
            <span class="badge" [ngClass]="getEstadoBadgeClass(appointment.estado)">
                {{ getEstadoLabel(appointment.estado) }}
            </span>
        </td>
        <td>
            <select class="form-select form-select-sm" 
                    [value]="appointment.estado" 
                    (change)="cambiarEstado(appointment.medicalAppointmentId, $event)">
                <option value="0">Pendiente</option>
                <option value="1">Completada</option>
                <option value="2">Cancelada</option>
            </select>
        </td>
    </tbody>
</table>

<!-- Tooltip flotante global -->
<div *ngIf="tooltipText" 
     class="global-tooltip" 
     [style.left.px]="tooltipX" 
     [style.top.px]="tooltipY">
    {{ tooltipText }}
</div>
