<div class="container content-with-toolbar">

    <!-- üîµ T√≠tulo principal -->
    <div class="page-title">
        <h1>Solicitar turno</h1>
    </div>

    <!-- üîµ Formulario de b√∫squeda -->
    <div class="search-form-section">
        <div class="search-form-content">
            <div class="form-row">
                <div class="form-group">
                    <label for="patientSelect">¬øPara qui√©n es el turno?</label>
                    <select id="patientSelect" class="form-control" [(ngModel)]="selectedPatient">
                        <option value="">Camila Catalini</option>
                        <option value="self">Para m√≠</option>
                        <option value="family">Para un familiar</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="coverageSelect">¬øQu√© cobertura tienes?</label>
                    <select id="coverageSelect" class="form-control" [(ngModel)]="selectedCoverage">
                        <option value="">Austral salud Mi Medico 3030</option>
                        <option value="austral">Austral Salud</option>
                        <option value="osde">OSDE</option>
                        <option value="swiss">Swiss Medical</option>
                        <option value="particular">Particular</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group search-input-group">
                    <label for="specialtySearch">¬øQu√© necesitas?</label>
                    <div class="search-input-container">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            type="text" 
                            id="specialtySearch" 
                            class="form-control search-input" 
                            placeholder="Escrib√≠ el nombre del profesional, especialidad o pr√°ctica"
                            [(ngModel)]="searchTerm"
                            (input)="onSearchChange()"
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üîµ Especialidades m√°s agendadas -->
    <div class="specialties-section">
        <h2>Pr√°cticas m√°s agendadas</h2>
        <div class="specialties-grid">
            <button 
                *ngFor="let specialty of mostScheduledSpecialties" 
                class="specialty-button"
                (click)="selectSpecialty(specialty)"
                [class.selected]="selectedSpecialty === specialty">
                {{ specialty }}
            </button>
        </div>
    </div>

    <!-- üîµ Especialidades m√°s buscadas -->
    <div class="specialties-section">
        <h2>Pr√°cticas m√°s buscadas</h2>
        <div class="specialties-grid">
            <button 
                *ngFor="let specialty of mostSearchedSpecialties" 
                class="specialty-button"
                (click)="selectSpecialty(specialty)"
                [class.selected]="selectedSpecialty === specialty">
                {{ specialty }}
            </button>
        </div>
    </div>

    <!-- üîµ Filtros adicionales -->
    <div class="filters-section" *ngIf="selectedSpecialty || searchTerm">
        <h4>Filtros adicionales:</h4>
        <div class="filters-row">
            <div class="filter-group">
                <label for="nameSelect">M√©dico:</label>
                <select id="nameSelect" class="form-control" [(ngModel)]="selectedName" (change)="filterTurnos()">
                    <option value="">Todos los m√©dicos</option>
                    <option *ngFor="let name of names" [value]="name">{{name}}</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="centerSelect">Centro m√©dico:</label>
                <select id="centerSelect" class="form-control" [(ngModel)]="selectedMedicalCenter" (change)="filterTurnos()">
                    <option value="">Todos los centros</option>
                    <option *ngFor="let center of medicalCenters" [value]="center">{{center}}</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="dateRange">Rango de fechas:</label>
                <button class="form-control date-range-button" (click)="showDateRangeModal = true">
                    <span *ngIf="!selectedDateRange.start || !selectedDateRange.end">Seleccionar fechas</span>
                    <span *ngIf="selectedDateRange.start && selectedDateRange.end">
                        {{selectedDateRange.start | date:'dd/MM/yyyy'}} - {{selectedDateRange.end | date:'dd/MM/yyyy'}}
                    </span>
                </button>
            </div>
        </div>
        
        <div class="availability-button-container">
            <button class="boton availability-button" (click)="showAvailability()">
                <i class="fas fa-search"></i> Buscar disponibilidad
            </button>
        </div>
    </div>

    <!-- üîµ Resultados - Turnos disponibles -->
    <div class="results-section" *ngIf="showResults && filteredTurnos.length > 0">
        <h2>Turnos disponibles</h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead class="table-dark">
                <tr>
                    <th>M√©dico</th>
                    <th>Especialidad</th>
                    <th>Centro M√©dico</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Acci√≥n</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let turno of getCurrentPageTurnos()">
                    <td>{{turno.medicName}}</td>
                    <td>{{turno.specialty}}</td>
                    <td>{{turno.medicalCenter}}</td>
                    <td>{{turno.fechaTurno | date:'dd/MM/yyyy'}}</td>
                    <td>{{turno.horaTurno}}</td>
                    <td>
                        <button class="btn btn-primary appointment-btn" (click)="redirectToAddTurno(turno.medicId)">
                            <i class="fas fa-calendar-plus"></i> Agendar
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Paginaci√≥n -->
        <div class="pagination-container" *ngIf="totalPages > 1">
            <nav aria-label="Navegaci√≥n de p√°ginas">
                <ul class="pagination justify-content-center">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" href="javascript:void(0)" (click)="goToPreviousPage()">
                            <i class="fas fa-chevron-left"></i> Anterior
                        </a>
                    </li>
                    
                    <li class="page-item" *ngFor="let page of getPageNumbers()" 
                        [class.active]="page === currentPage">
                        <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">
                            {{page}}
                        </a>
                    </li>
                    
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <a class="page-link" href="javascript:void(0)" (click)="goToNextPage()">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="pagination-info">
                <small class="text-muted">
                    P√°gina {{currentPage}} de {{totalPages}} 
                    ({{filteredTurnos.length}} turnos en total)
                </small>
            </div>
        </div>
    </div>

    <!-- üîµ Mensaje cuando no hay resultados -->
    <div class="no-results-section" *ngIf="showResults && filteredTurnos.length === 0">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            No hay turnos disponibles con los filtros seleccionados.
        </div>
    </div>

    <!-- üîµ Modal para seleccionar rango de fechas -->
    <div class="modal-backdrop show" *ngIf="showDateRangeModal"></div>
    <div class="modal show d-block" tabindex="-1" *ngIf="showDateRangeModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Seleccionar rango de fechas</h5>
                    <button type="button" class="close" (click)="showDateRangeModal = false">
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label>Fecha de inicio:</label>
                            <input type="date" class="form-control mb-3" [(ngModel)]="startDate" [min]="today">
                        </div>
                        <div class="col-md-6">
                            <label>Fecha de fin:</label>
                            <input type="date" class="form-control mb-3" [(ngModel)]="endDate" [min]="startDate || today">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" (click)="applyDateRange()">Aplicar</button>
                        <button type="button" class="btn btn-secondary" (click)="showDateRangeModal = false">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
