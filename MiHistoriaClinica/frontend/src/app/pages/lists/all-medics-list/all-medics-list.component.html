<div class="container content-with-toolbar">

    <!-- Título principal -->
    <div class="page-title">
        <h1>Reservar Turno</h1>
        <p class="subtitle">Encuentra y reserva tu próxima cita médica</p>
    </div>

    <!-- Sección de búsqueda -->
    <div class="search-section">
        <h4>Buscar Turno</h4>
        <div class="filters-row">
            <div class="filter-group">
                <label>Especialidad:</label>
                <select [(ngModel)]="selectedSpecialty" (change)="onSpecialtyChange()" class="filter-select">
                    <option value="">Seleccione una especialidad</option>
                    <option *ngFor="let specialty of specialties" [value]="specialty">{{specialty}}</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Médico:</label>
                <select [(ngModel)]="selectedName" (change)="onNameChange()" [disabled]="!selectedSpecialty" class="filter-select">
                    <option value="">Todos los médicos</option>
                    <option *ngFor="let name of names" [value]="name">{{name}}</option>
                </select>
                <small *ngIf="!selectedSpecialty" class="hint">Seleccione primero una especialidad</small>
            </div>
        </div>
    </div>

    <!-- Fechas disponibles -->
    <div *ngIf="selectedSpecialty && availableDates.length > 0" class="dates-section">
        <h4>Fechas Disponibles</h4>
        <p class="dates-subtitle">Selecciona un día para ver los horarios</p>
        <div class="dates-grid">
            <div *ngFor="let date of availableDates" 
                 class="date-chip"
                 [class.selected]="selectedDate === date"
                 (click)="selectDate(date)">
                <span class="day-name">{{ getDayName(date) }}</span>
                <span class="day-number">{{ getDayNumber(date) }}</span>
                <span class="month-name">{{ getMonthName(date) }}</span>
            </div>
        </div>
        <div *ngIf="selectedDate" class="selected-badge">
            <span>Mostrando turnos del <strong>{{ formatSelectedDate(selectedDate) }}</strong></span>
            <button (click)="clearDateFilter()" class="clear-btn">✕</button>
        </div>
    </div>

    <!-- Estado vacío: sin especialidad -->
    <div *ngIf="!selectedSpecialty" class="empty-section">
        <div class="empty-icon">
            <i class="fas fa-hospital"></i>
        </div>
        <h3>Selecciona una especialidad</h3>
        <p>Para ver los turnos disponibles, primero elige una especialidad médica</p>
    </div>

    <!-- Estado vacío: sin fechas -->
    <div *ngIf="selectedSpecialty && availableDates.length === 0 && !isLoading" class="empty-section">
        <div class="empty-icon">
            <i class="fas fa-calendar-times"></i>
        </div>
        <h3>No hay turnos disponibles</h3>
        <p>No se encontraron turnos para esta especialidad</p>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-section">
        <div class="spinner"></div>
        <span>Buscando turnos...</span>
    </div>

    <!-- Tabla de turnos -->
    <div *ngIf="selectedSpecialty && filteredTurnos.length > 0 && !isLoading" class="turnos-section">
        <h2 class="text-center">Turnos Disponibles</h2>
        <p class="turnos-count">Mostrando <strong>{{ filteredTurnos.length }}</strong> turno{{ filteredTurnos.length !== 1 ? 's' : '' }}</p>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Médico</th>
                        <th>Especialidad</th>
                        <th>Centro Médico</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let turno of getCurrentPageTurnos()">
                        <td><strong>{{ turno.medicName }}</strong></td>
                        <td>{{ turno.specialty }}</td>
                        <td>{{ turno.medicalCenter }}</td>
                        <td>{{ formatDateShort(turno.fechaTurno) }}</td>
                        <td class="hora-cell">{{ turno.horaTurno }}</td>
                        <td>
                            <button class="btn-reservar" (click)="reserveTurno(turno)">Reservar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginación -->
        <div *ngIf="totalPages > 1" class="pagination-container">
            <button [disabled]="currentPage === 1" (click)="goToPreviousPage()" class="page-btn">&lt;</button>
            <button *ngFor="let page of getPageNumbers()" 
                    [class.active]="page === currentPage" 
                    (click)="goToPage(page)" 
                    class="page-btn">{{ page }}</button>
            <button [disabled]="currentPage === totalPages" (click)="goToNextPage()" class="page-btn">&gt;</button>
        </div>
    </div>

    <!-- Sin turnos para fecha seleccionada -->
    <div *ngIf="selectedSpecialty && availableDates.length > 0 && filteredTurnos.length === 0 && selectedDate && !isLoading" class="empty-section">
        <div class="empty-icon">
            <i class="fas fa-search"></i>
        </div>
        <h3>No hay turnos para este día</h3>
        <p>Prueba seleccionando otra fecha</p>
    </div>

</div>
